#!/bin/bash -x
ZNC_CONFIG_BASEDIR=<%= scope.lookupvar('znc::params::zc_config_dir') %>
ACTIVE_USERS=`ls -F ${ZNC_CONFIG_BASEDIR}/users/ | xargs -n1 basename`
DEFINED_USERS=`grep \<User ${ZNC_CONFIG_BASEDIR}/configs/znc.conf | awk '{print $2}' | sed 's/\(.*\)./\1/'`

for d in ${DEFINED_USERS}
do
  if [[ ${ACTIVE_USERS[*]} =~ ${d} ]]
    then
      continue
    else
      sed -i "/<User ${d}>/,/<\/User>/ d" ${ZNC_CONFIG_BASEDIR}/configs/znc.conf
  fi
done

